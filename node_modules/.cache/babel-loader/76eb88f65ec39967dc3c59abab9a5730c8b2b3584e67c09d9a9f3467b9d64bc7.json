{"ast":null,"code":"var _jsxFileName = \"C:\\\\Development\\\\VibeVibes\\\\IP\\\\apps\\\\inspection-app\\\\src\\\\components\\\\SubmitReport.js\",\n  _s = $RefreshSig$();\n// src/components/SubmitReport.js\n\nimport React, { useState, useContext } from 'react';\nimport { addDoc, collection, serverTimestamp } from 'firebase/firestore';\nimport { auth, firestore } from '../services/firebase';\nimport { blobToDataURL } from '../utils/blobUtils';\nimport { InspectionContext } from '../contexts/InspectionContext';\n\n/**\n * Convert an array of media items into Firestore‐safe objects:\n *  - blob → base64 dataURL\n *  - GeolocationCoordinates → plain { latitude, longitude, accuracy }\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nasync function prepareMediaData(mediaItems) {\n  return Promise.all(mediaItems.map(async ({\n    blob,\n    location,\n    timestamp\n  }) => {\n    const dataURL = await blobToDataURL(blob);\n    return {\n      location: {\n        latitude: location.latitude,\n        longitude: location.longitude,\n        accuracy: location.accuracy\n      },\n      timestamp,\n      dataURL\n    };\n  }));\n}\nexport default function SubmitReport() {\n  _s();\n  const {\n    assetId,\n    photos,\n    videos,\n    defects,\n    vibrationResult,\n    rawVibrationData\n  } = useContext(InspectionContext);\n  const [loading, setLoading] = useState(false);\n  const [msg, setMsg] = useState('');\n  const handleSubmit = async () => {\n    setLoading(true);\n    setMsg('');\n    try {\n      const user = auth.currentUser;\n      if (!user) throw new Error('Not authenticated');\n      const uid = user.uid;\n      console.log('Converting photos…');\n      const photoData = await prepareMediaData(photos);\n      console.log('Converting videos…');\n      const videoData = await prepareMediaData(videos);\n      console.log('Writing report to Firestore…');\n      await addDoc(collection(firestore, `artifacts/demo/users/${uid}/inspection_reports`), {\n        assetId,\n        userId: uid,\n        timestamp: serverTimestamp(),\n        defects,\n        photoData,\n        videoData,\n        vibrationResult,\n        rawVibrationData: JSON.stringify(rawVibrationData)\n      });\n      setMsg('✅ Report submitted successfully! Reloading…');\n      // give user a moment to read the success message\n      setTimeout(() => {\n        window.location.reload();\n      }, 1000);\n    } catch (e) {\n      console.error('SubmitReport error:', e);\n      setMsg(`Submission failed: ${e.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleSubmit,\n      disabled: loading,\n      className: `w-full py-2 rounded shadow ${loading ? 'bg-gray-400' : 'bg-blue-600 hover:bg-blue-700'} text-white`,\n      children: loading ? 'Submitting...' : 'Submit Inspection Report'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 7\n    }, this), msg && /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"mt-3 text-center text-sm\",\n      children: msg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 90,\n    columnNumber: 5\n  }, this);\n}\n_s(SubmitReport, \"0Ob1vhTXqm43fkN0NTm80+D87HY=\");\n_c = SubmitReport;\nvar _c;\n$RefreshReg$(_c, \"SubmitReport\");","map":{"version":3,"names":["React","useState","useContext","addDoc","collection","serverTimestamp","auth","firestore","blobToDataURL","InspectionContext","jsxDEV","_jsxDEV","prepareMediaData","mediaItems","Promise","all","map","blob","location","timestamp","dataURL","latitude","longitude","accuracy","SubmitReport","_s","assetId","photos","videos","defects","vibrationResult","rawVibrationData","loading","setLoading","msg","setMsg","handleSubmit","user","currentUser","Error","uid","console","log","photoData","videoData","userId","JSON","stringify","setTimeout","window","reload","e","error","message","className","children","onClick","disabled","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Development/VibeVibes/IP/apps/inspection-app/src/components/SubmitReport.js"],"sourcesContent":["// src/components/SubmitReport.js\n\nimport React, { useState, useContext } from 'react';\nimport { addDoc, collection, serverTimestamp } from 'firebase/firestore';\nimport { auth, firestore } from '../services/firebase';\nimport { blobToDataURL } from '../utils/blobUtils';\nimport { InspectionContext } from '../contexts/InspectionContext';\n\n/**\n * Convert an array of media items into Firestore‐safe objects:\n *  - blob → base64 dataURL\n *  - GeolocationCoordinates → plain { latitude, longitude, accuracy }\n */\nasync function prepareMediaData(mediaItems) {\n  return Promise.all(\n    mediaItems.map(async ({ blob, location, timestamp }) => {\n      const dataURL = await blobToDataURL(blob);\n      return {\n        location: {\n          latitude: location.latitude,\n          longitude: location.longitude,\n          accuracy: location.accuracy,\n        },\n        timestamp,\n        dataURL,\n      };\n    })\n  );\n}\n\nexport default function SubmitReport() {\n  const {\n    assetId,\n    photos,\n    videos,\n    defects,\n    vibrationResult,\n    rawVibrationData,\n  } = useContext(InspectionContext);\n\n  const [loading, setLoading] = useState(false);\n  const [msg, setMsg] = useState('');\n\n  const handleSubmit = async () => {\n    setLoading(true);\n    setMsg('');\n    try {\n      const user = auth.currentUser;\n      if (!user) throw new Error('Not authenticated');\n      const uid = user.uid;\n\n      console.log('Converting photos…');\n      const photoData = await prepareMediaData(photos);\n\n      console.log('Converting videos…');\n      const videoData = await prepareMediaData(videos);\n\n      console.log('Writing report to Firestore…');\n      await addDoc(\n        collection(\n          firestore,\n          `artifacts/demo/users/${uid}/inspection_reports`\n        ),\n        {\n          assetId,\n          userId: uid,\n          timestamp: serverTimestamp(),\n          defects,\n          photoData,\n          videoData,\n          vibrationResult,\n          rawVibrationData: JSON.stringify(rawVibrationData),\n        }\n      );\n\n      setMsg('✅ Report submitted successfully! Reloading…');\n      // give user a moment to read the success message\n      setTimeout(() => {\n        window.location.reload();\n      }, 1000);\n    } catch (e) {\n      console.error('SubmitReport error:', e);\n      setMsg(`Submission failed: ${e.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"p-4\">\n      <button\n        onClick={handleSubmit}\n        disabled={loading}\n        className={`w-full py-2 rounded shadow ${\n          loading ? 'bg-gray-400' : 'bg-blue-600 hover:bg-blue-700'\n        } text-white`}\n      >\n        {loading ? 'Submitting...' : 'Submit Inspection Report'}\n      </button>\n      {msg && (\n        <p className=\"mt-3 text-center text-sm\">\n          {msg}\n        </p>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}