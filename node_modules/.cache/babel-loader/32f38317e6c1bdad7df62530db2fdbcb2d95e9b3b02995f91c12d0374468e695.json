{"ast":null,"code":"// src/components/SubmitReport.js\nimport React,{useState,useContext}from'react';import{addDoc,collection,serverTimestamp}from'firebase/firestore';import{auth,firestore}from'../services/firebase';import{blobToDataURL}from'../utils/blobUtils';import{InspectionContext}from'../contexts/InspectionContext';/**\n * Convert an array of media items into Firestore‐safe objects:\n *  - blob → base64 dataURL\n *  - GeolocationCoordinates → plain { latitude, longitude, accuracy }\n */import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";async function prepareMediaData(mediaItems){return Promise.all(mediaItems.map(async _ref=>{let{blob,location,timestamp}=_ref;const dataURL=await blobToDataURL(blob);return{location:{latitude:location.latitude,longitude:location.longitude,accuracy:location.accuracy},timestamp,dataURL};}));}export default function SubmitReport(){const{assetId,photos,videos,defects,vibrationResult,rawVibrationData}=useContext(InspectionContext);const[loading,setLoading]=useState(false);const[msg,setMsg]=useState('');const handleSubmit=async()=>{setLoading(true);setMsg('');try{const user=auth.currentUser;if(!user)throw new Error('Not authenticated');const uid=user.uid;console.log('Converting photos…');const photoData=await prepareMediaData(photos);console.log('Converting videos…');const videoData=await prepareMediaData(videos);console.log('Writing report to Firestore…');await addDoc(collection(firestore,\"artifacts/demo/users/\".concat(uid,\"/inspection_reports\")),{assetId,userId:uid,timestamp:serverTimestamp(),defects,photoData,videoData,vibrationResult,rawVibrationData:JSON.stringify(rawVibrationData)});setMsg('✅ Report submitted successfully! Reloading…');// give user a moment to read the success message\nsetTimeout(()=>{window.location.reload();},1000);}catch(e){console.error('SubmitReport error:',e);setMsg(\"Submission failed: \".concat(e.message));}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"p-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmit,disabled:loading,className:\"w-full py-2 rounded shadow \".concat(loading?'bg-gray-400':'bg-blue-600 hover:bg-blue-700',\" text-white\"),children:loading?'Submitting...':'Submit Inspection Report'}),msg&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-3 text-center text-sm\",children:msg})]});}","map":{"version":3,"names":["React","useState","useContext","addDoc","collection","serverTimestamp","auth","firestore","blobToDataURL","InspectionContext","jsx","_jsx","jsxs","_jsxs","prepareMediaData","mediaItems","Promise","all","map","_ref","blob","location","timestamp","dataURL","latitude","longitude","accuracy","SubmitReport","assetId","photos","videos","defects","vibrationResult","rawVibrationData","loading","setLoading","msg","setMsg","handleSubmit","user","currentUser","Error","uid","console","log","photoData","videoData","concat","userId","JSON","stringify","setTimeout","window","reload","e","error","message","className","children","onClick","disabled"],"sources":["C:/Development/VibeVibes/IP/apps/inspection-app/src/components/SubmitReport.js"],"sourcesContent":["// src/components/SubmitReport.js\n\nimport React, { useState, useContext } from 'react';\nimport { addDoc, collection, serverTimestamp } from 'firebase/firestore';\nimport { auth, firestore } from '../services/firebase';\nimport { blobToDataURL } from '../utils/blobUtils';\nimport { InspectionContext } from '../contexts/InspectionContext';\n\n/**\n * Convert an array of media items into Firestore‐safe objects:\n *  - blob → base64 dataURL\n *  - GeolocationCoordinates → plain { latitude, longitude, accuracy }\n */\nasync function prepareMediaData(mediaItems) {\n  return Promise.all(\n    mediaItems.map(async ({ blob, location, timestamp }) => {\n      const dataURL = await blobToDataURL(blob);\n      return {\n        location: {\n          latitude: location.latitude,\n          longitude: location.longitude,\n          accuracy: location.accuracy,\n        },\n        timestamp,\n        dataURL,\n      };\n    })\n  );\n}\n\nexport default function SubmitReport() {\n  const {\n    assetId,\n    photos,\n    videos,\n    defects,\n    vibrationResult,\n    rawVibrationData,\n  } = useContext(InspectionContext);\n\n  const [loading, setLoading] = useState(false);\n  const [msg, setMsg] = useState('');\n\n  const handleSubmit = async () => {\n    setLoading(true);\n    setMsg('');\n    try {\n      const user = auth.currentUser;\n      if (!user) throw new Error('Not authenticated');\n      const uid = user.uid;\n\n      console.log('Converting photos…');\n      const photoData = await prepareMediaData(photos);\n\n      console.log('Converting videos…');\n      const videoData = await prepareMediaData(videos);\n\n      console.log('Writing report to Firestore…');\n      await addDoc(\n        collection(\n          firestore,\n          `artifacts/demo/users/${uid}/inspection_reports`\n        ),\n        {\n          assetId,\n          userId: uid,\n          timestamp: serverTimestamp(),\n          defects,\n          photoData,\n          videoData,\n          vibrationResult,\n          rawVibrationData: JSON.stringify(rawVibrationData),\n        }\n      );\n\n      setMsg('✅ Report submitted successfully! Reloading…');\n      // give user a moment to read the success message\n      setTimeout(() => {\n        window.location.reload();\n      }, 1000);\n    } catch (e) {\n      console.error('SubmitReport error:', e);\n      setMsg(`Submission failed: ${e.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"p-4\">\n      <button\n        onClick={handleSubmit}\n        disabled={loading}\n        className={`w-full py-2 rounded shadow ${\n          loading ? 'bg-gray-400' : 'bg-blue-600 hover:bg-blue-700'\n        } text-white`}\n      >\n        {loading ? 'Submitting...' : 'Submit Inspection Report'}\n      </button>\n      {msg && (\n        <p className=\"mt-3 text-center text-sm\">\n          {msg}\n        </p>\n      )}\n    </div>\n  );\n}\n\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}