{"ast":null,"code":"/*\nFile: apps/inspection-app/src/components/MediaCapture.js\n*/import React,{useRef,useState,useEffect,useContext}from'react';import{InspectionContext}from'../contexts/InspectionContext';import{getCurrentPosition}from'../services/geolocation';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function MediaCapture(){const videoRef=useRef(null);const recorderRef=useRef(null);const{photos,setPhotos,videos,setVideos}=useContext(InspectionContext);const[stream,setStream]=useState(null);const[recording,setRecording]=useState(false);const[error,setError]=useState('');// Initialize camera on user gesture\nconst initCamera=async()=>{try{// Pick rear camera if possible\nconst devices=await navigator.mediaDevices.enumerateDevices();const rearDevice=devices.find(d=>d.kind==='videoinput'&&/back|rear|environment/gi.test(d.label));const constraints={video:rearDevice?{deviceId:{exact:rearDevice.deviceId}}:{facingMode:'environment'},audio:true};const s=await navigator.mediaDevices.getUserMedia(constraints);setStream(s);videoRef.current.srcObject=s;const recorder=new MediaRecorder(s);recorder.ondataavailable=async e=>{const blob=e.data;let position;try{position=await getCurrentPosition();}catch(_unused){position={coords:{latitude:null,longitude:null,accuracy:null},timestamp:Date.now()};}const{latitude,longitude,accuracy}=position.coords;const timestamp=position.timestamp;const url=URL.createObjectURL(blob);setVideos(v=>[...v,{blob,url,location:{latitude,longitude,accuracy},timestamp}]);};recorderRef.current=recorder;}catch(e){console.error('Camera init error:',e);setError(e.message||'Failed to access camera. Make sure you’ve granted permissions.');}};const takePhoto=()=>{if(!stream){return setError('Camera not initialized');}const video=videoRef.current;const canvas=document.createElement('canvas');canvas.width=video.videoWidth;canvas.height=video.videoHeight;canvas.getContext('2d').drawImage(video,0,0);canvas.toBlob(async blob=>{let position;try{position=await getCurrentPosition();}catch(_unused2){position={coords:{latitude:null,longitude:null,accuracy:null},timestamp:Date.now()};}const{latitude,longitude,accuracy}=position.coords;const timestamp=position.timestamp;const url=URL.createObjectURL(blob);setPhotos(p=>[...p,{blob,url,location:{latitude,longitude,accuracy},timestamp}]);},'image/jpeg');};const toggleRec=()=>{if(!recorderRef.current){return setError('Camera not initialized');}if(recording){recorderRef.current.stop();setRecording(false);}else{recorderRef.current.start();setRecording(true);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[!stream&&/*#__PURE__*/_jsx(\"button\",{onClick:initCamera,className:\"bg-blue-600 text-white px-4 py-2 rounded mb-2\",children:\"Initialize Camera\"}),error&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-red-600 mb-2\",children:[\"Error: \",error]}),stream&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,playsInline:true,muted:true,className:\"w-full max-w-md mb-2 rounded shadow\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-x-2 mb-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:takePhoto,className:\"bg-green-500 text-white px-3 py-1 rounded\",children:\"Take Photo\"}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleRec,className:\"bg-yellow-500 text-white px-3 py-1 rounded\",children:recording?'Stop Recording':'Record Video'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2 overflow-x-auto\",children:[photos.map((p,i)=>/*#__PURE__*/_jsx(\"img\",{src:p.url,alt:\"Photo \".concat(i+1),className:\"w-20 h-20 object-cover rounded\"},i)),videos.map((v,i)=>/*#__PURE__*/_jsx(\"video\",{src:v.url,controls:true,className:\"w-20 h-20 rounded\"},i))]})]})]});}","map":{"version":3,"names":["React","useRef","useState","useEffect","useContext","InspectionContext","getCurrentPosition","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MediaCapture","videoRef","recorderRef","photos","setPhotos","videos","setVideos","stream","setStream","recording","setRecording","error","setError","initCamera","devices","navigator","mediaDevices","enumerateDevices","rearDevice","find","d","kind","test","label","constraints","video","deviceId","exact","facingMode","audio","s","getUserMedia","current","srcObject","recorder","MediaRecorder","ondataavailable","e","blob","data","position","_unused","coords","latitude","longitude","accuracy","timestamp","Date","now","url","URL","createObjectURL","v","location","console","message","takePhoto","canvas","document","createElement","width","videoWidth","height","videoHeight","getContext","drawImage","toBlob","_unused2","p","toggleRec","stop","start","className","children","onClick","ref","autoPlay","playsInline","muted","map","i","src","alt","concat","controls"],"sources":["C:/Development/VibeVibes/IP/apps/inspection-app/src/components/MediaCapture.js"],"sourcesContent":["/*\nFile: apps/inspection-app/src/components/MediaCapture.js\n*/\nimport React, { useRef, useState, useEffect, useContext } from 'react';\nimport { InspectionContext } from '../contexts/InspectionContext';\nimport { getCurrentPosition } from '../services/geolocation';\n\nexport default function MediaCapture() {\n  const videoRef     = useRef(null);\n  const recorderRef  = useRef(null);\n  const { photos, setPhotos, videos, setVideos } = useContext(InspectionContext);\n\n  const [stream, setStream]       = useState(null);\n  const [recording, setRecording] = useState(false);\n  const [error, setError]         = useState('');\n\n  // Initialize camera on user gesture\n  const initCamera = async () => {\n    try {\n      // Pick rear camera if possible\n      const devices = await navigator.mediaDevices.enumerateDevices();\n      const rearDevice = devices.find(\n        d => d.kind === 'videoinput' && /back|rear|environment/gi.test(d.label)\n      );\n      const constraints = {\n        video: rearDevice\n          ? { deviceId: { exact: rearDevice.deviceId } }\n          : { facingMode: 'environment' },\n        audio: true\n      };\n\n      const s = await navigator.mediaDevices.getUserMedia(constraints);\n      setStream(s);\n      videoRef.current.srcObject = s;\n\n      const recorder = new MediaRecorder(s);\n      recorder.ondataavailable = async e => {\n        const blob = e.data;\n        let position;\n        try {\n          position = await getCurrentPosition();\n        } catch {\n          position = { coords: { latitude: null, longitude: null, accuracy: null }, timestamp: Date.now() };\n        }\n        const { latitude, longitude, accuracy } = position.coords;\n        const timestamp = position.timestamp;\n        const url = URL.createObjectURL(blob);\n\n        setVideos(v => [\n          ...v,\n          { blob, url, location: { latitude, longitude, accuracy }, timestamp }\n        ]);\n      };\n      recorderRef.current = recorder;\n    } catch (e) {\n      console.error('Camera init error:', e);\n      setError(e.message || 'Failed to access camera. Make sure you’ve granted permissions.');\n    }\n  };\n\n  const takePhoto = () => {\n    if (!stream) {\n      return setError('Camera not initialized');\n    }\n    const video = videoRef.current;\n    const canvas = document.createElement('canvas');\n    canvas.width  = video.videoWidth;\n    canvas.height = video.videoHeight;\n    canvas.getContext('2d').drawImage(video, 0, 0);\n    canvas.toBlob(async blob => {\n      let position;\n      try {\n        position = await getCurrentPosition();\n      } catch {\n        position = { coords: { latitude: null, longitude: null, accuracy: null }, timestamp: Date.now() };\n      }\n      const { latitude, longitude, accuracy } = position.coords;\n      const timestamp = position.timestamp;\n      const url = URL.createObjectURL(blob);\n\n      setPhotos(p => [\n        ...p,\n        { blob, url, location: { latitude, longitude, accuracy }, timestamp }\n      ]);\n    }, 'image/jpeg');\n  };\n\n  const toggleRec = () => {\n    if (!recorderRef.current) {\n      return setError('Camera not initialized');\n    }\n    if (recording) {\n      recorderRef.current.stop();\n      setRecording(false);\n    } else {\n      recorderRef.current.start();\n      setRecording(true);\n    }\n  };\n\n  return (\n    <div className=\"mb-4\">\n      {!stream && (\n        <button\n          onClick={initCamera}\n          className=\"bg-blue-600 text-white px-4 py-2 rounded mb-2\"\n        >\n          Initialize Camera\n        </button>\n      )}\n      {error && (\n        <p className=\"text-red-600 mb-2\">Error: {error}</p>\n      )}\n      {stream && (\n        <>\n          <video\n            ref={videoRef}\n            autoPlay\n            playsInline\n            muted\n            className=\"w-full max-w-md mb-2 rounded shadow\"\n          />\n          <div className=\"space-x-2 mb-2\">\n            <button\n              onClick={takePhoto}\n              className=\"bg-green-500 text-white px-3 py-1 rounded\"\n            >\n              Take Photo\n            </button>\n            <button\n              onClick={toggleRec}\n              className=\"bg-yellow-500 text-white px-3 py-1 rounded\"\n            >\n              {recording ? 'Stop Recording' : 'Record Video'}\n            </button>\n          </div>\n          <div className=\"flex space-x-2 overflow-x-auto\">\n            {photos.map((p, i) => (\n              <img\n                key={i}\n                src={p.url}\n                alt={`Photo ${i + 1}`}\n                className=\"w-20 h-20 object-cover rounded\"\n              />\n            ))}\n            {videos.map((v, i) => (\n              <video\n                key={i}\n                src={v.url}\n                controls\n                className=\"w-20 h-20 rounded\"\n              />\n            ))}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n"],"mappings":"AAAA;AACA;AACA,EACA,MAAO,CAAAA,KAAK,EAAIC,MAAM,CAAEC,QAAQ,CAAEC,SAAS,CAAEC,UAAU,KAAQ,OAAO,CACtE,OAASC,iBAAiB,KAAQ,+BAA+B,CACjE,OAASC,kBAAkB,KAAQ,yBAAyB,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAE7D,cAAe,SAAS,CAAAC,YAAYA,CAAA,CAAG,CACrC,KAAM,CAAAC,QAAQ,CAAOb,MAAM,CAAC,IAAI,CAAC,CACjC,KAAM,CAAAc,WAAW,CAAId,MAAM,CAAC,IAAI,CAAC,CACjC,KAAM,CAAEe,MAAM,CAAEC,SAAS,CAAEC,MAAM,CAAEC,SAAU,CAAC,CAAGf,UAAU,CAACC,iBAAiB,CAAC,CAE9E,KAAM,CAACe,MAAM,CAAEC,SAAS,CAAC,CAASnB,QAAQ,CAAC,IAAI,CAAC,CAChD,KAAM,CAACoB,SAAS,CAAEC,YAAY,CAAC,CAAGrB,QAAQ,CAAC,KAAK,CAAC,CACjD,KAAM,CAACsB,KAAK,CAAEC,QAAQ,CAAC,CAAWvB,QAAQ,CAAC,EAAE,CAAC,CAE9C;AACA,KAAM,CAAAwB,UAAU,CAAG,KAAAA,CAAA,GAAY,CAC7B,GAAI,CACF;AACA,KAAM,CAAAC,OAAO,CAAG,KAAM,CAAAC,SAAS,CAACC,YAAY,CAACC,gBAAgB,CAAC,CAAC,CAC/D,KAAM,CAAAC,UAAU,CAAGJ,OAAO,CAACK,IAAI,CAC7BC,CAAC,EAAIA,CAAC,CAACC,IAAI,GAAK,YAAY,EAAI,yBAAyB,CAACC,IAAI,CAACF,CAAC,CAACG,KAAK,CACxE,CAAC,CACD,KAAM,CAAAC,WAAW,CAAG,CAClBC,KAAK,CAAEP,UAAU,CACb,CAAEQ,QAAQ,CAAE,CAAEC,KAAK,CAAET,UAAU,CAACQ,QAAS,CAAE,CAAC,CAC5C,CAAEE,UAAU,CAAE,aAAc,CAAC,CACjCC,KAAK,CAAE,IACT,CAAC,CAED,KAAM,CAAAC,CAAC,CAAG,KAAM,CAAAf,SAAS,CAACC,YAAY,CAACe,YAAY,CAACP,WAAW,CAAC,CAChEhB,SAAS,CAACsB,CAAC,CAAC,CACZ7B,QAAQ,CAAC+B,OAAO,CAACC,SAAS,CAAGH,CAAC,CAE9B,KAAM,CAAAI,QAAQ,CAAG,GAAI,CAAAC,aAAa,CAACL,CAAC,CAAC,CACrCI,QAAQ,CAACE,eAAe,CAAG,KAAM,CAAAC,CAAC,EAAI,CACpC,KAAM,CAAAC,IAAI,CAAGD,CAAC,CAACE,IAAI,CACnB,GAAI,CAAAC,QAAQ,CACZ,GAAI,CACFA,QAAQ,CAAG,KAAM,CAAA/C,kBAAkB,CAAC,CAAC,CACvC,CAAE,MAAAgD,OAAA,CAAM,CACND,QAAQ,CAAG,CAAEE,MAAM,CAAE,CAAEC,QAAQ,CAAE,IAAI,CAAEC,SAAS,CAAE,IAAI,CAAEC,QAAQ,CAAE,IAAK,CAAC,CAAEC,SAAS,CAAEC,IAAI,CAACC,GAAG,CAAC,CAAE,CAAC,CACnG,CACA,KAAM,CAAEL,QAAQ,CAAEC,SAAS,CAAEC,QAAS,CAAC,CAAGL,QAAQ,CAACE,MAAM,CACzD,KAAM,CAAAI,SAAS,CAAGN,QAAQ,CAACM,SAAS,CACpC,KAAM,CAAAG,GAAG,CAAGC,GAAG,CAACC,eAAe,CAACb,IAAI,CAAC,CAErChC,SAAS,CAAC8C,CAAC,EAAI,CACb,GAAGA,CAAC,CACJ,CAAEd,IAAI,CAAEW,GAAG,CAAEI,QAAQ,CAAE,CAAEV,QAAQ,CAAEC,SAAS,CAAEC,QAAS,CAAC,CAAEC,SAAU,CAAC,CACtE,CAAC,CACJ,CAAC,CACD5C,WAAW,CAAC8B,OAAO,CAAGE,QAAQ,CAChC,CAAE,MAAOG,CAAC,CAAE,CACViB,OAAO,CAAC3C,KAAK,CAAC,oBAAoB,CAAE0B,CAAC,CAAC,CACtCzB,QAAQ,CAACyB,CAAC,CAACkB,OAAO,EAAI,gEAAgE,CAAC,CACzF,CACF,CAAC,CAED,KAAM,CAAAC,SAAS,CAAGA,CAAA,GAAM,CACtB,GAAI,CAACjD,MAAM,CAAE,CACX,MAAO,CAAAK,QAAQ,CAAC,wBAAwB,CAAC,CAC3C,CACA,KAAM,CAAAa,KAAK,CAAGxB,QAAQ,CAAC+B,OAAO,CAC9B,KAAM,CAAAyB,MAAM,CAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC,CAC/CF,MAAM,CAACG,KAAK,CAAInC,KAAK,CAACoC,UAAU,CAChCJ,MAAM,CAACK,MAAM,CAAGrC,KAAK,CAACsC,WAAW,CACjCN,MAAM,CAACO,UAAU,CAAC,IAAI,CAAC,CAACC,SAAS,CAACxC,KAAK,CAAE,CAAC,CAAE,CAAC,CAAC,CAC9CgC,MAAM,CAACS,MAAM,CAAC,KAAM,CAAA5B,IAAI,EAAI,CAC1B,GAAI,CAAAE,QAAQ,CACZ,GAAI,CACFA,QAAQ,CAAG,KAAM,CAAA/C,kBAAkB,CAAC,CAAC,CACvC,CAAE,MAAA0E,QAAA,CAAM,CACN3B,QAAQ,CAAG,CAAEE,MAAM,CAAE,CAAEC,QAAQ,CAAE,IAAI,CAAEC,SAAS,CAAE,IAAI,CAAEC,QAAQ,CAAE,IAAK,CAAC,CAAEC,SAAS,CAAEC,IAAI,CAACC,GAAG,CAAC,CAAE,CAAC,CACnG,CACA,KAAM,CAAEL,QAAQ,CAAEC,SAAS,CAAEC,QAAS,CAAC,CAAGL,QAAQ,CAACE,MAAM,CACzD,KAAM,CAAAI,SAAS,CAAGN,QAAQ,CAACM,SAAS,CACpC,KAAM,CAAAG,GAAG,CAAGC,GAAG,CAACC,eAAe,CAACb,IAAI,CAAC,CAErClC,SAAS,CAACgE,CAAC,EAAI,CACb,GAAGA,CAAC,CACJ,CAAE9B,IAAI,CAAEW,GAAG,CAAEI,QAAQ,CAAE,CAAEV,QAAQ,CAAEC,SAAS,CAAEC,QAAS,CAAC,CAAEC,SAAU,CAAC,CACtE,CAAC,CACJ,CAAC,CAAE,YAAY,CAAC,CAClB,CAAC,CAED,KAAM,CAAAuB,SAAS,CAAGA,CAAA,GAAM,CACtB,GAAI,CAACnE,WAAW,CAAC8B,OAAO,CAAE,CACxB,MAAO,CAAApB,QAAQ,CAAC,wBAAwB,CAAC,CAC3C,CACA,GAAIH,SAAS,CAAE,CACbP,WAAW,CAAC8B,OAAO,CAACsC,IAAI,CAAC,CAAC,CAC1B5D,YAAY,CAAC,KAAK,CAAC,CACrB,CAAC,IAAM,CACLR,WAAW,CAAC8B,OAAO,CAACuC,KAAK,CAAC,CAAC,CAC3B7D,YAAY,CAAC,IAAI,CAAC,CACpB,CACF,CAAC,CAED,mBACEb,KAAA,QAAK2E,SAAS,CAAC,MAAM,CAAAC,QAAA,EAClB,CAAClE,MAAM,eACNZ,IAAA,WACE+E,OAAO,CAAE7D,UAAW,CACpB2D,SAAS,CAAC,+CAA+C,CAAAC,QAAA,CAC1D,mBAED,CAAQ,CACT,CACA9D,KAAK,eACJd,KAAA,MAAG2E,SAAS,CAAC,mBAAmB,CAAAC,QAAA,EAAC,SAAO,CAAC9D,KAAK,EAAI,CACnD,CACAJ,MAAM,eACLV,KAAA,CAAAE,SAAA,EAAA0E,QAAA,eACE9E,IAAA,UACEgF,GAAG,CAAE1E,QAAS,CACd2E,QAAQ,MACRC,WAAW,MACXC,KAAK,MACLN,SAAS,CAAC,qCAAqC,CAChD,CAAC,cACF3E,KAAA,QAAK2E,SAAS,CAAC,gBAAgB,CAAAC,QAAA,eAC7B9E,IAAA,WACE+E,OAAO,CAAElB,SAAU,CACnBgB,SAAS,CAAC,2CAA2C,CAAAC,QAAA,CACtD,YAED,CAAQ,CAAC,cACT9E,IAAA,WACE+E,OAAO,CAAEL,SAAU,CACnBG,SAAS,CAAC,4CAA4C,CAAAC,QAAA,CAErDhE,SAAS,CAAG,gBAAgB,CAAG,cAAc,CACxC,CAAC,EACN,CAAC,cACNZ,KAAA,QAAK2E,SAAS,CAAC,gCAAgC,CAAAC,QAAA,EAC5CtE,MAAM,CAAC4E,GAAG,CAAC,CAACX,CAAC,CAAEY,CAAC,gBACfrF,IAAA,QAEEsF,GAAG,CAAEb,CAAC,CAACnB,GAAI,CACXiC,GAAG,UAAAC,MAAA,CAAWH,CAAC,CAAG,CAAC,CAAG,CACtBR,SAAS,CAAC,gCAAgC,EAHrCQ,CAIN,CACF,CAAC,CACD3E,MAAM,CAAC0E,GAAG,CAAC,CAAC3B,CAAC,CAAE4B,CAAC,gBACfrF,IAAA,UAEEsF,GAAG,CAAE7B,CAAC,CAACH,GAAI,CACXmC,QAAQ,MACRZ,SAAS,CAAC,mBAAmB,EAHxBQ,CAIN,CACF,CAAC,EACC,CAAC,EACN,CACH,EACE,CAAC,CAEV","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}