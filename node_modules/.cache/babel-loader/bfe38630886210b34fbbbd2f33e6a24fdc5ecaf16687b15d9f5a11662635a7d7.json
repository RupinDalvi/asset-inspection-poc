{"ast":null,"code":"/*\nFile: apps/inspection-app/src/components/MediaCapture.js\n*/import React,{useRef,useState,useEffect,useContext}from'react';import{InspectionContext}from'../contexts/InspectionContext';import{getCurrentPosition}from'../services/geolocation';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function MediaCapture(){const videoRef=useRef(null);const recorderRef=useRef(null);const[recording,setRecording]=useState(false);const{photos,setPhotos,videos,setVideos}=useContext(InspectionContext);useEffect(()=>{let stream;async function initMedia(){try{// Request the rear camera if available\nstream=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:'environment'}},audio:true});videoRef.current.srcObject=stream;recorderRef.current=new MediaRecorder(stream);recorderRef.current.ondataavailable=async e=>{const blob=e.data;let pos;try{pos=await getCurrentPosition();}catch(_unused){pos={latitude:null,longitude:null,accuracy:null,timestamp:Date.now()};}const url=URL.createObjectURL(blob);setVideos(v=>[...v,{blob,url,location:pos,timestamp:pos.timestamp}]);};}catch(err){console.error('MediaCapture init error:',err);}}initMedia();return()=>{if(stream)stream.getTracks().forEach(t=>t.stop());};},[]);const takePhoto=()=>{const video=videoRef.current;const canvas=document.createElement('canvas');canvas.width=video.videoWidth;canvas.height=video.videoHeight;canvas.getContext('2d').drawImage(video,0,0);canvas.toBlob(async blob=>{let pos;try{pos=await getCurrentPosition();}catch(_unused2){pos={latitude:null,longitude:null,accuracy:null,timestamp:Date.now()};}const url=URL.createObjectURL(blob);setPhotos(p=>[...p,{blob,url,location:pos,timestamp:pos.timestamp}]);},'image/jpeg');};const toggleRec=()=>{if(recording){recorderRef.current.stop();setRecording(false);}else{recorderRef.current.start();setRecording(true);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,playsInline:true,muted:true,className:\"w-full max-w-md mb-2 rounded shadow\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:takePhoto,className:\"bg-green-500 text-white px-3 py-1 rounded\",children:\"Take Photo\"}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleRec,className:\"bg-yellow-500 text-white px-3 py-1 rounded\",children:recording?'Stop Recording':'Record Video'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 flex space-x-2 overflow-x-auto\",children:[photos.map((p,i)=>/*#__PURE__*/_jsx(\"img\",{src:p.url,alt:\"Photo \".concat(i+1),className:\"w-20 h-20 object-cover rounded\"},i)),videos.map((v,i)=>/*#__PURE__*/_jsx(\"video\",{src:v.url,controls:true,className:\"w-20 h-20 rounded\"},i))]})]});}","map":{"version":3,"names":["React","useRef","useState","useEffect","useContext","InspectionContext","getCurrentPosition","jsx","_jsx","jsxs","_jsxs","MediaCapture","videoRef","recorderRef","recording","setRecording","photos","setPhotos","videos","setVideos","stream","initMedia","navigator","mediaDevices","getUserMedia","video","facingMode","ideal","audio","current","srcObject","MediaRecorder","ondataavailable","e","blob","data","pos","_unused","latitude","longitude","accuracy","timestamp","Date","now","url","URL","createObjectURL","v","location","err","console","error","getTracks","forEach","t","stop","takePhoto","canvas","document","createElement","width","videoWidth","height","videoHeight","getContext","drawImage","toBlob","_unused2","p","toggleRec","start","className","children","ref","autoPlay","playsInline","muted","onClick","map","i","src","alt","concat","controls"],"sources":["C:/Development/VibeVibes/IP/apps/inspection-app/src/components/MediaCapture.js"],"sourcesContent":["/*\nFile: apps/inspection-app/src/components/MediaCapture.js\n*/\n\nimport React, { useRef, useState, useEffect, useContext } from 'react';\nimport { InspectionContext } from '../contexts/InspectionContext';\nimport { getCurrentPosition } from '../services/geolocation';\n\nexport default function MediaCapture() {\n  const videoRef = useRef(null);\n  const recorderRef = useRef(null);\n  const [recording, setRecording] = useState(false);\n  const { photos, setPhotos, videos, setVideos } = useContext(InspectionContext);\n\n  useEffect(() => {\n    let stream;\n    async function initMedia() {\n      try {\n        // Request the rear camera if available\n        stream = await navigator.mediaDevices.getUserMedia({\n          video: { facingMode: { ideal: 'environment' } },\n          audio: true\n        });\n        videoRef.current.srcObject = stream;\n        recorderRef.current = new MediaRecorder(stream);\n\n        recorderRef.current.ondataavailable = async (e) => {\n          const blob = e.data;\n          let pos;\n          try { pos = await getCurrentPosition(); }\n          catch { pos = { latitude: null, longitude: null, accuracy: null, timestamp: Date.now() }; }\n          const url = URL.createObjectURL(blob);\n          setVideos(v => [...v, { blob, url, location: pos, timestamp: pos.timestamp }]);\n        };\n      } catch (err) {\n        console.error('MediaCapture init error:', err);\n      }\n    }\n\n    initMedia();\n\n    return () => {\n      if (stream) stream.getTracks().forEach(t => t.stop());\n    };\n  }, []);\n\n  const takePhoto = () => {\n    const video = videoRef.current;\n    const canvas = document.createElement('canvas');\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    canvas.getContext('2d').drawImage(video, 0, 0);\n    canvas.toBlob(async (blob) => {\n      let pos;\n      try { pos = await getCurrentPosition(); }\n      catch { pos = { latitude: null, longitude: null, accuracy: null, timestamp: Date.now() }; }\n      const url = URL.createObjectURL(blob);\n      setPhotos(p => [...p, { blob, url, location: pos, timestamp: pos.timestamp }]);\n    }, 'image/jpeg');\n  };\n\n  const toggleRec = () => {\n    if (recording) {\n      recorderRef.current.stop();\n      setRecording(false);\n    } else {\n      recorderRef.current.start();\n      setRecording(true);\n    }\n  };\n\n  return (\n    <div className=\"mb-4\">\n      <video\n        ref={videoRef}\n        autoPlay\n        playsInline\n        muted\n        className=\"w-full max-w-md mb-2 rounded shadow\"\n      />\n      <div className=\"space-x-2\">\n        <button onClick={takePhoto} className=\"bg-green-500 text-white px-3 py-1 rounded\">\n          Take Photo\n        </button>\n        <button onClick={toggleRec} className=\"bg-yellow-500 text-white px-3 py-1 rounded\">\n          {recording ? 'Stop Recording' : 'Record Video'}\n        </button>\n      </div>\n      <div className=\"mt-2 flex space-x-2 overflow-x-auto\">\n        {photos.map((p, i) => (\n          <img key={i} src={p.url} alt={`Photo ${i+1}`} className=\"w-20 h-20 object-cover rounded\" />\n        ))}\n        {videos.map((v, i) => (\n          <video key={i} src={v.url} controls className=\"w-20 h-20 rounded\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}