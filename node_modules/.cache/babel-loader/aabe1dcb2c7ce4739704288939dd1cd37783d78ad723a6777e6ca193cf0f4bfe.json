{"ast":null,"code":"import React,{useRef,useState,useEffect,useContext}from'react';import{InspectionContext}from'../contexts/InspectionContext';import{getCurrentPosition}from'../services/geolocation';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function MediaCapture(){const videoRef=useRef();const recorderRef=useRef();const[recording,setRecording]=useState(false);const{photos,setPhotos,videos,setVideos}=useContext(InspectionContext);useEffect(()=>{(async()=>{try{const stream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});videoRef.current.srcObject=stream;recorderRef.current=new MediaRecorder(stream);recorderRef.current.ondataavailable=async e=>{const blob=e.data;let pos;try{pos=await getCurrentPosition();}catch(_unused){pos={coords:null,timestamp:Date.now()};}const url=URL.createObjectURL(blob);setVideos(v=>[...v,{blob,location:pos.coords,timestamp:pos.timestamp,url}]);};}catch(err){console.error(err);}})();return()=>{var _videoRef$current,_videoRef$current$src;return(_videoRef$current=videoRef.current)===null||_videoRef$current===void 0?void 0:(_videoRef$current$src=_videoRef$current.srcObject)===null||_videoRef$current$src===void 0?void 0:_videoRef$current$src.getTracks().forEach(t=>t.stop());};},[]);const takePhoto=()=>{const video=videoRef.current;const canvas=document.createElement('canvas');canvas.width=video.videoWidth;canvas.height=video.videoHeight;canvas.getContext('2d').drawImage(video,0,0);canvas.toBlob(async blob=>{let pos;try{pos=await getCurrentPosition();}catch(_unused2){pos={coords:null,timestamp:Date.now()};}const url=URL.createObjectURL(blob);setPhotos(p=>[...p,{blob,location:pos.coords,timestamp:pos.timestamp,url}]);},'image/jpeg');};const toggleRec=()=>{if(recording){recorderRef.current.stop();setRecording(false);}else{recorderRef.current.start();setRecording(true);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,muted:true,className:\"w-full max-w-md mb-2 rounded shadow\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:takePhoto,className:\"bg-green-500 text-white px-3 py-1 rounded\",children:\"Take Photo\"}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleRec,className:\"bg-yellow-500 text-white px-3 py-1 rounded\",children:recording?'Stop Recording':'Record Video'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 flex space-x-2 overflow-x-auto\",children:[photos.map((p,i)=>/*#__PURE__*/_jsx(\"img\",{src:p.url,className:\"w-20 h-20 object-cover rounded\"},i)),videos.map((v,i)=>/*#__PURE__*/_jsx(\"video\",{src:v.url,controls:true,className:\"w-20 h-20 rounded\"},i))]})]});}","map":{"version":3,"names":["React","useRef","useState","useEffect","useContext","InspectionContext","getCurrentPosition","jsx","_jsx","jsxs","_jsxs","MediaCapture","videoRef","recorderRef","recording","setRecording","photos","setPhotos","videos","setVideos","stream","navigator","mediaDevices","getUserMedia","video","audio","current","srcObject","MediaRecorder","ondataavailable","e","blob","data","pos","_unused","coords","timestamp","Date","now","url","URL","createObjectURL","v","location","err","console","error","_videoRef$current","_videoRef$current$src","getTracks","forEach","t","stop","takePhoto","canvas","document","createElement","width","videoWidth","height","videoHeight","getContext","drawImage","toBlob","_unused2","p","toggleRec","start","className","children","ref","autoPlay","muted","onClick","map","i","src","controls"],"sources":["C:/Development/VibeVibes/IP/apps/inspection-app/src/components/MediaCapture.js"],"sourcesContent":["import React, { useRef, useState, useEffect, useContext } from 'react';\nimport { InspectionContext } from '../contexts/InspectionContext';\nimport { getCurrentPosition } from '../services/geolocation';\nexport default function MediaCapture() {\n  const videoRef = useRef();\n  const recorderRef = useRef();\n  const [recording, setRecording] = useState(false);\n  const { photos, setPhotos, videos, setVideos } = useContext(InspectionContext);\n  useEffect(() => {\n    (async () => {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });\n        videoRef.current.srcObject = stream;\n        recorderRef.current = new MediaRecorder(stream);\n        recorderRef.current.ondataavailable = async e => {\n          const blob = e.data;\n          let pos;\n          try { pos = await getCurrentPosition(); } catch { pos = { coords: null, timestamp: Date.now() }; }\n          const url = URL.createObjectURL(blob);\n          setVideos(v => [...v, { blob, location: pos.coords, timestamp: pos.timestamp, url }]);\n        };\n      } catch (err) { console.error(err); }\n    })();\n    return () => videoRef.current?.srcObject?.getTracks().forEach(t => t.stop());\n  }, []);\n\n  const takePhoto = () => {\n    const video = videoRef.current;\n    const canvas = document.createElement('canvas');\n    canvas.width = video.videoWidth; canvas.height = video.videoHeight;\n    canvas.getContext('2d').drawImage(video,0,0);\n    canvas.toBlob(async blob => {\n      let pos;\n      try { pos = await getCurrentPosition(); } catch { pos={coords:null,timestamp:Date.now()}; }\n      const url = URL.createObjectURL(blob);\n      setPhotos(p => [...p, { blob, location: pos.coords, timestamp: pos.timestamp, url }]);\n    }, 'image/jpeg');\n  };\n  const toggleRec = () => {\n    if (recording) { recorderRef.current.stop(); setRecording(false); }\n    else { recorderRef.current.start(); setRecording(true); }\n  };\n  return (\n    <div className=\"mb-4\">\n      <video ref={videoRef} autoPlay muted className=\"w-full max-w-md mb-2 rounded shadow\" />\n      <div className=\"space-x-2\">\n        <button onClick={takePhoto} className=\"bg-green-500 text-white px-3 py-1 rounded\">Take Photo</button>\n        <button onClick={toggleRec} className=\"bg-yellow-500 text-white px-3 py-1 rounded\">\n          {recording ? 'Stop Recording' : 'Record Video'}\n        </button>\n      </div>\n      <div className=\"mt-2 flex space-x-2 overflow-x-auto\">\n        {photos.map((p,i) => <img key={i} src={p.url} className=\"w-20 h-20 object-cover rounded\" />)}\n        {videos.map((v,i) => <video key={i} src={v.url} controls className=\"w-20 h-20 rounded\" />)}\n      </div>\n    </div>\n  );\n}\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}