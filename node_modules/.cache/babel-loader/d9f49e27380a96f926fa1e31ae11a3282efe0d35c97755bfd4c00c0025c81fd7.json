{"ast":null,"code":"/*\nFile: apps/inspection-app/src/components/SubmitReport.js\n*/import React,{useState,useContext}from'react';import{auth,firestore}from'../services/firebase';import{collection,addDoc,serverTimestamp}from'firebase/firestore';import{InspectionContext}from'../contexts/InspectionContext';// Convert Blob to DataURL\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function blobToDataURL(blob){return new Promise((resolve,reject)=>{const r=new FileReader();r.onerror=reject;r.onload=()=>resolve(r.result);r.readAsDataURL(blob);});}// Prepare media items for Firestore\nasync function prepareMediaData(items){return Promise.all(items.map(async _ref=>{var _location$latitude,_location$longitude,_location$accuracy;let{blob,location,timestamp}=_ref;const dataURL=await blobToDataURL(blob);return{dataURL,location:{latitude:(_location$latitude=location===null||location===void 0?void 0:location.latitude)!==null&&_location$latitude!==void 0?_location$latitude:null,longitude:(_location$longitude=location===null||location===void 0?void 0:location.longitude)!==null&&_location$longitude!==void 0?_location$longitude:null,accuracy:(_location$accuracy=location===null||location===void 0?void 0:location.accuracy)!==null&&_location$accuracy!==void 0?_location$accuracy:null},timestamp:timestamp!==null&&timestamp!==void 0?timestamp:null};}));}export default function SubmitReport(){const{assetId,photos,videos,defects,vibrationResult,rawVibrationData}=useContext(InspectionContext);const[loading,setLoading]=useState(false);const[msg,setMsg]=useState('');const handleSubmit=async()=>{setLoading(true);setMsg('');try{const user=auth.currentUser;if(!user)throw new Error('Not authenticated');const photoData=await prepareMediaData(photos);const videoData=await prepareMediaData(videos);await addDoc(collection(firestore,\"artifacts/demo/users/\".concat(user.uid,\"/inspection_reports\")),{assetId,userId:user.uid,timestamp:serverTimestamp(),defects,photoData,videoData,vibrationResult,rawVibrationData:JSON.stringify(rawVibrationData||[])});setMsg('✅ Report submitted successfully!');// reset by reloading\nsetTimeout(()=>window.location.reload(),1000);}catch(e){console.error('SubmitReport error:',e);setMsg(\"Submission failed: \".concat(e.message));}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleSubmit,disabled:loading,className:\"w-full bg-purple-500 text-white px-4 py-2 rounded disabled:opacity-50\",children:loading?'Submitting...':'Submit Inspection Report'}),msg&&/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-center\",children:msg})]});}","map":{"version":3,"names":["React","useState","useContext","auth","firestore","collection","addDoc","serverTimestamp","InspectionContext","jsx","_jsx","jsxs","_jsxs","blobToDataURL","blob","Promise","resolve","reject","r","FileReader","onerror","onload","result","readAsDataURL","prepareMediaData","items","all","map","_ref","_location$latitude","_location$longitude","_location$accuracy","location","timestamp","dataURL","latitude","longitude","accuracy","SubmitReport","assetId","photos","videos","defects","vibrationResult","rawVibrationData","loading","setLoading","msg","setMsg","handleSubmit","user","currentUser","Error","photoData","videoData","concat","uid","userId","JSON","stringify","setTimeout","window","reload","e","console","error","message","className","children","onClick","disabled"],"sources":["C:/Development/VibeVibes/IP/apps/inspection-app/src/components/SubmitReport.js"],"sourcesContent":["/*\nFile: apps/inspection-app/src/components/SubmitReport.js\n*/\nimport React, { useState, useContext } from 'react';\nimport { auth, firestore } from '../services/firebase';\nimport { collection, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { InspectionContext } from '../contexts/InspectionContext';\n\n// Convert Blob to DataURL\nfunction blobToDataURL(blob) {\n  return new Promise((resolve, reject) => {\n    const r = new FileReader();\n    r.onerror = reject;\n    r.onload = () => resolve(r.result);\n    r.readAsDataURL(blob);\n  });\n}\n\n// Prepare media items for Firestore\nasync function prepareMediaData(items) {\n  return Promise.all(\n    items.map(async ({ blob, location, timestamp }) => {\n      const dataURL = await blobToDataURL(blob);\n      return {\n        dataURL,\n        location: {\n          latitude: location?.latitude ?? null,\n          longitude: location?.longitude ?? null,\n          accuracy: location?.accuracy ?? null\n        },\n        timestamp: timestamp ?? null\n      };\n    })\n  );\n}\n\nexport default function SubmitReport() {\n  const {\n    assetId,\n    photos,\n    videos,\n    defects,\n    vibrationResult,\n    rawVibrationData\n  } = useContext(InspectionContext);\n\n  const [loading, setLoading] = useState(false);\n  const [msg, setMsg] = useState('');\n\n  const handleSubmit = async () => {\n    setLoading(true);\n    setMsg('');\n    try {\n      const user = auth.currentUser;\n      if (!user) throw new Error('Not authenticated');\n\n      const photoData = await prepareMediaData(photos);\n      const videoData = await prepareMediaData(videos);\n\n      await addDoc(\n        collection(\n          firestore,\n          `artifacts/demo/users/${user.uid}/inspection_reports`\n        ),\n        {\n          assetId,\n          userId: user.uid,\n          timestamp: serverTimestamp(),\n          defects,\n          photoData,\n          videoData,\n          vibrationResult,\n          rawVibrationData: JSON.stringify(rawVibrationData || [])\n        }\n      );\n\n      setMsg('✅ Report submitted successfully!');\n      // reset by reloading\n      setTimeout(() => window.location.reload(), 1000);\n    } catch (e) {\n      console.error('SubmitReport error:', e);\n      setMsg(`Submission failed: ${e.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"mt-4\">\n      <button\n        onClick={handleSubmit}\n        disabled={loading}\n        className=\"w-full bg-purple-500 text-white px-4 py-2 rounded disabled:opacity-50\"\n      >\n        {loading ? 'Submitting...' : 'Submit Inspection Report'}\n      </button>\n      {msg && <p className=\"mt-2 text-center\">{msg}</p>}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}