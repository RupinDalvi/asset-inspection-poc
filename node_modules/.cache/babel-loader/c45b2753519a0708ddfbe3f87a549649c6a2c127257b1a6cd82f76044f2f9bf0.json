{"ast":null,"code":"var _jsxFileName = \"C:\\\\Development\\\\VibeVibes\\\\IP\\\\apps\\\\inspection-app\\\\src\\\\components\\\\SubmitReport.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useContext } from 'react';\nimport { auth, firestore } from '../services/firebase';\nimport { collection, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { InspectionContext } from '../contexts/InspectionContext';\n\n// Helper to convert Blob to base64 DataURL\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction blobToDataURL(blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onloadend = () => resolve(reader.result);\n    reader.onerror = reject;\n    reader.readAsDataURL(blob);\n  });\n}\nexport default function SubmitReport() {\n  _s();\n  const {\n    assetId,\n    photos,\n    videos,\n    defects,\n    vibrationResult,\n    rawVibrationData\n  } = useContext(InspectionContext);\n  const [loading, setLoading] = useState(false);\n  const [msg, setMsg] = useState(null);\n  const submit = async () => {\n    setLoading(true);\n    try {\n      const uid = auth.currentUser.uid;\n      const timestamp = Date.now();\n\n      // Convert media to base64 for Firestore storage\n      const photoData = await Promise.all(photos.map(p => blobToDataURL(p.blob).then(dataURL => ({\n        dataURL,\n        location: p.location,\n        timestamp: p.timestamp\n      }))));\n      const videoData = await Promise.all(videos.map(v => blobToDataURL(v.blob).then(dataURL => ({\n        dataURL,\n        location: v.location,\n        timestamp: v.timestamp\n      }))));\n\n      // Write document\n      await addDoc(collection(firestore, `artifacts/demo/users/${uid}/inspection_reports`), {\n        assetId,\n        userId: uid,\n        timestamp: serverTimestamp(),\n        defects,\n        photoData,\n        videoData,\n        vibrationResult,\n        rawVibrationData\n      });\n      setMsg('Report submitted successfully');\n    } catch (e) {\n      console.error(e);\n      setMsg(`Submission failed: ${e.message}`);\n    }\n    setLoading(false);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"mt-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: submit,\n      disabled: loading,\n      className: \"bg-purple-500 text-white px-4 py-2 rounded disabled:opacity-50\",\n      children: loading ? 'Submitting...' : 'Submit Inspection Report'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }, this), msg && /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"mt-2\",\n      children: msg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 15\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 59,\n    columnNumber: 5\n  }, this);\n}\n_s(SubmitReport, \"FkC4eapt7+hgjNVIIuNt2lO3rD8=\");\n_c = SubmitReport;\nvar _c;\n$RefreshReg$(_c, \"SubmitReport\");","map":{"version":3,"names":["React","useState","useContext","auth","firestore","collection","addDoc","serverTimestamp","InspectionContext","jsxDEV","_jsxDEV","blobToDataURL","blob","Promise","resolve","reject","reader","FileReader","onloadend","result","onerror","readAsDataURL","SubmitReport","_s","assetId","photos","videos","defects","vibrationResult","rawVibrationData","loading","setLoading","msg","setMsg","submit","uid","currentUser","timestamp","Date","now","photoData","all","map","p","then","dataURL","location","videoData","v","userId","e","console","error","message","className","children","onClick","disabled","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Development/VibeVibes/IP/apps/inspection-app/src/components/SubmitReport.js"],"sourcesContent":["import React, { useState, useContext } from 'react';\nimport { auth, firestore } from '../services/firebase';\nimport { collection, addDoc, serverTimestamp } from 'firebase/firestore';\nimport { InspectionContext } from '../contexts/InspectionContext';\n\n// Helper to convert Blob to base64 DataURL\nfunction blobToDataURL(blob) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onloadend = () => resolve(reader.result);\n    reader.onerror = reject;\n    reader.readAsDataURL(blob);\n  });\n}\n\nexport default function SubmitReport() {\n  const { assetId, photos, videos, defects, vibrationResult, rawVibrationData } = useContext(InspectionContext);\n  const [loading,setLoading]=useState(false);\n  const [msg,setMsg]=useState(null);\n\n  const submit = async () => {\n    setLoading(true);\n    try {\n      const uid = auth.currentUser.uid;\n      const timestamp = Date.now();\n\n      // Convert media to base64 for Firestore storage\n      const photoData = await Promise.all(\n        photos.map(p => blobToDataURL(p.blob).then(dataURL => ({ dataURL, location: p.location, timestamp: p.timestamp })))\n      );\n      const videoData = await Promise.all(\n        videos.map(v => blobToDataURL(v.blob).then(dataURL => ({ dataURL, location: v.location, timestamp: v.timestamp })))\n      );\n\n      // Write document\n      await addDoc(\n        collection(firestore, `artifacts/demo/users/${uid}/inspection_reports`),\n        {\n          assetId,\n          userId: uid,\n          timestamp: serverTimestamp(),\n          defects,\n          photoData,\n          videoData,\n          vibrationResult,\n          rawVibrationData\n        }\n      );\n\n      setMsg('Report submitted successfully');\n    } catch (e) {\n      console.error(e);\n      setMsg(`Submission failed: ${e.message}`);\n    }\n    setLoading(false);\n  };\n\n  return (\n    <div className=\"mt-4\">\n      <button onClick={submit} disabled={loading} className=\"bg-purple-500 text-white px-4 py-2 rounded disabled:opacity-50\">\n        {loading ? 'Submitting...' : 'Submit Inspection Report'}\n      </button>\n      {msg && <p className=\"mt-2\">{msg}</p>}\n    </div>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}