{"ast":null,"code":"var _jsxFileName = \"C:\\\\Development\\\\VibeVibes\\\\IP\\\\apps\\\\inspection-app\\\\src\\\\components\\\\SubmitReport.js\",\n  _s = $RefreshSig$();\n// src/components/SubmitReport.js\n\nimport React, { useState, useContext } from 'react';\nimport { addDoc, collection, serverTimestamp } from 'firebase/firestore';\nimport { auth, firestore } from '../services/firebase';\nimport { blobToDataURL } from '../utils/blobUtils';\nimport { InspectionContext } from '../contexts/InspectionContext';\n\n/**\n * Convert an array of media items into Firestore‐safe objects:\n *  - blob → base64 dataURL\n *  - GeolocationCoordinates → plain { latitude, longitude, accuracy }\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nasync function prepareMediaData(mediaItems) {\n  return Promise.all(mediaItems.map(async ({\n    blob,\n    location,\n    timestamp\n  }) => {\n    // 1. Convert the blob to a DataURL\n    const dataURL = await blobToDataURL(blob);\n\n    // 2. Normalize location (could be a GeolocationCoordinates object)\n    //    Extract only the numeric fields we care about.\n    const normalizedLocation = {\n      latitude: location.latitude,\n      longitude: location.longitude,\n      accuracy: location.accuracy\n    };\n    return {\n      location: normalizedLocation,\n      timestamp,\n      dataURL\n    };\n  }));\n}\nexport default function SubmitReport() {\n  _s();\n  const {\n    assetId,\n    photos,\n    videos,\n    defects,\n    vibrationResult,\n    rawVibrationData,\n    resetInspection\n  } = useContext(InspectionContext);\n  const [loading, setLoading] = useState(false);\n  const [msg, setMsg] = useState('');\n  const handleSubmit = async () => {\n    setLoading(true);\n    setMsg('');\n    try {\n      const user = auth.currentUser;\n      if (!user) throw new Error('Not authenticated');\n      const uid = user.uid;\n      console.log('▶️ Converting photos to DataURLs…');\n      const photoData = await prepareMediaData(photos);\n      console.log('▶️ Converting videos to DataURLs…');\n      const videoData = await prepareMediaData(videos);\n      console.log('▶️ Writing report document…');\n      await addDoc(collection(firestore, `artifacts/demo/users/${uid}/inspection_reports`), {\n        assetId,\n        userId: uid,\n        timestamp: serverTimestamp(),\n        defects,\n        photoData,\n        videoData,\n        vibrationResult,\n        rawVibrationData: JSON.stringify(rawVibrationData)\n      });\n      setMsg('✅ Report submitted successfully!');\n      resetInspection();\n    } catch (e) {\n      console.error('❌ SubmitReport error:', e);\n      setMsg(`Submission failed: ${e.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleSubmit,\n      disabled: loading,\n      className: `w-full py-2 rounded shadow ${loading ? 'bg-gray-400' : 'bg-blue-600 hover:bg-blue-700'} text-white`,\n      children: loading ? 'Submitting...' : 'Submit Inspection Report'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 7\n    }, this), msg && /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"mt-3 text-center text-sm\",\n      children: msg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 94,\n    columnNumber: 5\n  }, this);\n}\n_s(SubmitReport, \"89dPzKhUZpqWzkcz1Y2kmAbGH70=\");\n_c = SubmitReport;\nvar _c;\n$RefreshReg$(_c, \"SubmitReport\");","map":{"version":3,"names":["React","useState","useContext","addDoc","collection","serverTimestamp","auth","firestore","blobToDataURL","InspectionContext","jsxDEV","_jsxDEV","prepareMediaData","mediaItems","Promise","all","map","blob","location","timestamp","dataURL","normalizedLocation","latitude","longitude","accuracy","SubmitReport","_s","assetId","photos","videos","defects","vibrationResult","rawVibrationData","resetInspection","loading","setLoading","msg","setMsg","handleSubmit","user","currentUser","Error","uid","console","log","photoData","videoData","userId","JSON","stringify","e","error","message","className","children","onClick","disabled","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Development/VibeVibes/IP/apps/inspection-app/src/components/SubmitReport.js"],"sourcesContent":["// src/components/SubmitReport.js\n\nimport React, { useState, useContext } from 'react';\nimport { addDoc, collection, serverTimestamp } from 'firebase/firestore';\nimport { auth, firestore } from '../services/firebase';\nimport { blobToDataURL } from '../utils/blobUtils';\nimport { InspectionContext } from '../contexts/InspectionContext';\n\n/**\n * Convert an array of media items into Firestore‐safe objects:\n *  - blob → base64 dataURL\n *  - GeolocationCoordinates → plain { latitude, longitude, accuracy }\n */\nasync function prepareMediaData(mediaItems) {\n  return Promise.all(\n    mediaItems.map(async ({ blob, location, timestamp }) => {\n      // 1. Convert the blob to a DataURL\n      const dataURL = await blobToDataURL(blob);\n\n      // 2. Normalize location (could be a GeolocationCoordinates object)\n      //    Extract only the numeric fields we care about.\n      const normalizedLocation = {\n        latitude: location.latitude,\n        longitude: location.longitude,\n        accuracy: location.accuracy,\n      };\n\n      return {\n        location: normalizedLocation,\n        timestamp,\n        dataURL,\n      };\n    })\n  );\n}\n\nexport default function SubmitReport() {\n  const {\n    assetId,\n    photos,\n    videos,\n    defects,\n    vibrationResult,\n    rawVibrationData,\n    resetInspection,\n  } = useContext(InspectionContext);\n\n  const [loading, setLoading] = useState(false);\n  const [msg, setMsg] = useState('');\n\n  const handleSubmit = async () => {\n    setLoading(true);\n    setMsg('');\n    try {\n      const user = auth.currentUser;\n      if (!user) throw new Error('Not authenticated');\n      const uid = user.uid;\n\n      console.log('▶️ Converting photos to DataURLs…');\n      const photoData = await prepareMediaData(photos);\n\n      console.log('▶️ Converting videos to DataURLs…');\n      const videoData = await prepareMediaData(videos);\n\n      console.log('▶️ Writing report document…');\n      await addDoc(\n        collection(\n          firestore,\n          `artifacts/demo/users/${uid}/inspection_reports`\n        ),\n        {\n          assetId,\n          userId: uid,\n          timestamp: serverTimestamp(),\n          defects,\n          photoData,\n          videoData,\n          vibrationResult,\n          rawVibrationData: JSON.stringify(rawVibrationData),\n        }\n      );\n\n      setMsg('✅ Report submitted successfully!');\n      resetInspection();\n    } catch (e) {\n      console.error('❌ SubmitReport error:', e);\n      setMsg(`Submission failed: ${e.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"p-4\">\n      <button\n        onClick={handleSubmit}\n        disabled={loading}\n        className={`w-full py-2 rounded shadow ${\n          loading ? 'bg-gray-400' : 'bg-blue-600 hover:bg-blue-700'\n        } text-white`}\n      >\n        {loading ? 'Submitting...' : 'Submit Inspection Report'}\n      </button>\n      {msg && (\n        <p className=\"mt-3 text-center text-sm\">\n          {msg}\n        </p>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}