{"ast":null,"code":"var _jsxFileName = \"C:\\\\Development\\\\VibeVibes\\\\IP\\\\apps\\\\inspection-app\\\\src\\\\components\\\\SubmitReport.js\",\n  _s = $RefreshSig$();\n// src/components/SubmitReport.js\n\nimport React, { useState, useContext } from 'react';\nimport { addDoc, collection, serverTimestamp } from 'firebase/firestore';\nimport { auth, firestore } from '../services/firebase';\nimport { blobToDataURL } from '../utils/blobUtils';\nimport { InspectionContext } from '../contexts/InspectionContext';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nasync function prepareMediaData(mediaItems) {\n  // mediaItems: array of { blob: Blob, location: {...}, timestamp: number }\n  return Promise.all(mediaItems.map(async ({\n    blob,\n    location,\n    timestamp\n  }) => {\n    const dataURL = await blobToDataURL(blob);\n    return {\n      location,\n      timestamp,\n      dataURL\n    };\n  }));\n}\nexport default function SubmitReport() {\n  _s();\n  const {\n    assetId,\n    photos,\n    videos,\n    defects,\n    vibrationResult,\n    rawVibrationData,\n    resetInspection // to clear context and go back to home\n  } = useContext(InspectionContext);\n  const [loading, setLoading] = useState(false);\n  const [msg, setMsg] = useState('');\n  const handleSubmit = async () => {\n    setLoading(true);\n    setMsg('');\n    try {\n      const user = auth.currentUser;\n      if (!user) throw new Error('Not authenticated');\n      const uid = user.uid;\n      const ts = Date.now();\n      console.log('▶️ Converting photos...');\n      const photoData = await prepareMediaData(photos);\n      console.log('▶️ Converting videos...');\n      const videoData = await prepareMediaData(videos);\n      console.log('▶️ Writing report to Firestore...');\n      await addDoc(collection(firestore, `artifacts/demo/users/${uid}/inspection_reports`), {\n        assetId,\n        userId: uid,\n        timestamp: serverTimestamp(),\n        defects,\n        photoData,\n        videoData,\n        vibrationResult,\n        rawVibrationData: JSON.stringify(rawVibrationData)\n      });\n      setMsg('✅ Report submitted successfully!');\n      // reset state & navigate back\n      resetInspection();\n    } catch (e) {\n      console.error('❌ SubmitReport error:', e);\n      setMsg(`Submission failed: ${e.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-4\",\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleSubmit,\n      disabled: loading,\n      className: `w-full py-2 rounded shadow ${loading ? 'bg-gray-400' : 'bg-blue-600 hover:bg-blue-700'} text-white`,\n      children: loading ? 'Submitting...' : 'Submit Inspection Report'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }, this), msg && /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"mt-3 text-center text-sm\",\n      children: msg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 5\n  }, this);\n}\n_s(SubmitReport, \"6IYl8eKLGStYRH0uR/lka8AtJqI=\");\n_c = SubmitReport;\nvar _c;\n$RefreshReg$(_c, \"SubmitReport\");","map":{"version":3,"names":["React","useState","useContext","addDoc","collection","serverTimestamp","auth","firestore","blobToDataURL","InspectionContext","jsxDEV","_jsxDEV","prepareMediaData","mediaItems","Promise","all","map","blob","location","timestamp","dataURL","SubmitReport","_s","assetId","photos","videos","defects","vibrationResult","rawVibrationData","resetInspection","loading","setLoading","msg","setMsg","handleSubmit","user","currentUser","Error","uid","ts","Date","now","console","log","photoData","videoData","userId","JSON","stringify","e","error","message","className","children","onClick","disabled","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Development/VibeVibes/IP/apps/inspection-app/src/components/SubmitReport.js"],"sourcesContent":["// src/components/SubmitReport.js\n\nimport React, { useState, useContext } from 'react';\nimport { addDoc, collection, serverTimestamp } from 'firebase/firestore';\nimport { auth, firestore } from '../services/firebase';\nimport { blobToDataURL } from '../utils/blobUtils';\nimport { InspectionContext } from '../contexts/InspectionContext';\n\nasync function prepareMediaData(mediaItems) {\n  // mediaItems: array of { blob: Blob, location: {...}, timestamp: number }\n  return Promise.all(\n    mediaItems.map(async ({ blob, location, timestamp }) => {\n      const dataURL = await blobToDataURL(blob);\n      return { location, timestamp, dataURL };\n    })\n  );\n}\n\nexport default function SubmitReport() {\n  const {\n    assetId,\n    photos,\n    videos,\n    defects,\n    vibrationResult,\n    rawVibrationData,\n    resetInspection,    // to clear context and go back to home\n  } = useContext(InspectionContext);\n\n  const [loading, setLoading] = useState(false);\n  const [msg, setMsg] = useState('');\n\n  const handleSubmit = async () => {\n    setLoading(true);\n    setMsg('');\n    try {\n      const user = auth.currentUser;\n      if (!user) throw new Error('Not authenticated');\n      const uid = user.uid;\n      const ts = Date.now();\n\n      console.log('▶️ Converting photos...');\n      const photoData = await prepareMediaData(photos);\n      console.log('▶️ Converting videos...');\n      const videoData = await prepareMediaData(videos);\n\n      console.log('▶️ Writing report to Firestore...');\n      await addDoc(\n        collection(\n          firestore,\n          `artifacts/demo/users/${uid}/inspection_reports`\n        ),\n        {\n          assetId,\n          userId: uid,\n          timestamp: serverTimestamp(),\n          defects,\n          photoData,\n          videoData,\n          vibrationResult,\n          rawVibrationData: JSON.stringify(rawVibrationData),\n        }\n      );\n\n      setMsg('✅ Report submitted successfully!');\n      // reset state & navigate back\n      resetInspection();\n    } catch (e) {\n      console.error('❌ SubmitReport error:', e);\n      setMsg(`Submission failed: ${e.message}`);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"p-4\">\n      <button\n        onClick={handleSubmit}\n        disabled={loading}\n        className={`w-full py-2 rounded shadow ${\n          loading ? 'bg-gray-400' : 'bg-blue-600 hover:bg-blue-700'\n        } text-white`}\n      >\n        {loading ? 'Submitting...' : 'Submit Inspection Report'}\n      </button>\n      {msg && (\n        <p className=\"mt-3 text-center text-sm\">\n          {msg}\n        </p>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}