{"ast":null,"code":"/*\nFile: apps/inspection-app/src/components/MediaCapture.js\n*/import React,{useRef,useState,useContext}from'react';import{InspectionContext}from'../contexts/InspectionContext';import{getCurrentPosition}from'../services/geolocation';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export default function MediaCapture(){const videoRef=useRef(null);const recorderRef=useRef(null);const{photos,setPhotos,videos,setVideos}=useContext(InspectionContext);const[stream,setStream]=useState(null);const[recording,setRecording]=useState(false);const[error,setError]=useState('');const initCamera=async()=>{setError('');let s;// 1️⃣ Try rear‐facing *video only*\ntry{s=await navigator.mediaDevices.getUserMedia({video:{facingMode:{exact:'environment'}}});}catch(envErr){// 2️⃣ Fallback to any camera\ntry{s=await navigator.mediaDevices.getUserMedia({video:true});}catch(anyErr){console.error('getUserMedia failed:',anyErr);setError('Camera permission denied or not available.');return;}}// 🎥 Got a stream!\nsetStream(s);videoRef.current.srcObject=s;// MediaRecorder (record video only)\nrecorderRef.current=new MediaRecorder(s);recorderRef.current.ondataavailable=async e=>{const blob=e.data;let pos;try{pos=await getCurrentPosition();}catch(_unused){pos={coords:{latitude:null,longitude:null,accuracy:null},timestamp:Date.now()};}const{latitude,longitude,accuracy}=pos.coords;setVideos(v=>[...v,{blob,url:URL.createObjectURL(blob),location:{latitude,longitude,accuracy},timestamp:pos.timestamp}]);};};const takePhoto=()=>{if(!stream)return setError('Please initialize the camera first.');const video=videoRef.current;const canvas=document.createElement('canvas');canvas.width=video.videoWidth;canvas.height=video.videoHeight;canvas.getContext('2d').drawImage(video,0,0);canvas.toBlob(async blob=>{let pos;try{pos=await getCurrentPosition();}catch(_unused2){pos={coords:{latitude:null,longitude:null,accuracy:null},timestamp:Date.now()};}const{latitude,longitude,accuracy}=pos.coords;setPhotos(p=>[...p,{blob,url:URL.createObjectURL(blob),location:{latitude,longitude,accuracy},timestamp:pos.timestamp}]);},'image/jpeg');};const toggleRec=()=>{if(!recorderRef.current)return setError('Please initialize the camera first.');if(recording){recorderRef.current.stop();setRecording(false);}else{recorderRef.current.start();setRecording(true);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[!stream&&/*#__PURE__*/_jsx(\"button\",{onClick:initCamera,className:\"bg-blue-600 text-white px-4 py-2 rounded mb-2\",children:\"Initialize Camera\"}),error&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-red-600 mb-2\",children:[\"Error: \",error]}),stream&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,playsInline:true,muted:true,className:\"w-full max-w-md mb-2 rounded shadow\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-x-2 mb-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:takePhoto,className:\"bg-green-500 text-white px-3 py-1 rounded\",children:\"Take Photo\"}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleRec,className:\"bg-yellow-500 text-white px-3 py-1 rounded\",children:recording?'Stop Recording':'Record Video'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2 overflow-x-auto\",children:[photos.map((p,i)=>/*#__PURE__*/_jsx(\"img\",{src:p.url,className:\"w-20 h-20 object-cover rounded\"},i)),videos.map((v,i)=>/*#__PURE__*/_jsx(\"video\",{src:v.url,controls:true,className:\"w-20 h-20 rounded\"},i))]})]});}","map":{"version":3,"names":["React","useRef","useState","useContext","InspectionContext","getCurrentPosition","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MediaCapture","videoRef","recorderRef","photos","setPhotos","videos","setVideos","stream","setStream","recording","setRecording","error","setError","initCamera","s","navigator","mediaDevices","getUserMedia","video","facingMode","exact","envErr","anyErr","console","current","srcObject","MediaRecorder","ondataavailable","e","blob","data","pos","_unused","coords","latitude","longitude","accuracy","timestamp","Date","now","v","url","URL","createObjectURL","location","takePhoto","canvas","document","createElement","width","videoWidth","height","videoHeight","getContext","drawImage","toBlob","_unused2","p","toggleRec","stop","start","className","children","onClick","ref","autoPlay","playsInline","muted","map","i","src","controls"],"sources":["C:/Development/VibeVibes/IP/apps/inspection-app/src/components/MediaCapture.js"],"sourcesContent":["/*\nFile: apps/inspection-app/src/components/MediaCapture.js\n*/\nimport React, { useRef, useState, useContext } from 'react';\nimport { InspectionContext } from '../contexts/InspectionContext';\nimport { getCurrentPosition } from '../services/geolocation';\n\nexport default function MediaCapture() {\n  const videoRef    = useRef(null);\n  const recorderRef = useRef(null);\n  const { photos, setPhotos, videos, setVideos } = useContext(InspectionContext);\n\n  const [stream, setStream]       = useState(null);\n  const [recording, setRecording] = useState(false);\n  const [error, setError]         = useState('');\n\n  const initCamera = async () => {\n    setError('');\n    let s;\n    // 1️⃣ Try rear‐facing *video only*\n    try {\n      s = await navigator.mediaDevices.getUserMedia({\n        video: { facingMode: { exact: 'environment' } }\n      });\n    } catch (envErr) {\n      // 2️⃣ Fallback to any camera\n      try {\n        s = await navigator.mediaDevices.getUserMedia({ video: true });\n      } catch (anyErr) {\n        console.error('getUserMedia failed:', anyErr);\n        setError('Camera permission denied or not available.');\n        return;\n      }\n    }\n\n    // 🎥 Got a stream!\n    setStream(s);\n    videoRef.current.srcObject = s;\n\n    // MediaRecorder (record video only)\n    recorderRef.current = new MediaRecorder(s);\n    recorderRef.current.ondataavailable = async (e) => {\n      const blob = e.data;\n      let pos;\n      try { pos = await getCurrentPosition(); }\n      catch { pos = { coords:{latitude:null,longitude:null,accuracy:null}, timestamp:Date.now() }; }\n      const { latitude, longitude, accuracy } = pos.coords;\n      setVideos(v => [\n        ...v,\n        {\n          blob,\n          url: URL.createObjectURL(blob),\n          location: { latitude, longitude, accuracy },\n          timestamp: pos.timestamp\n        }\n      ]);\n    };\n  };\n\n  const takePhoto = () => {\n    if (!stream) return setError('Please initialize the camera first.');\n    const video = videoRef.current;\n    const canvas = document.createElement('canvas');\n    canvas.width  = video.videoWidth;\n    canvas.height = video.videoHeight;\n    canvas.getContext('2d').drawImage(video, 0, 0);\n    canvas.toBlob(async blob => {\n      let pos;\n      try { pos = await getCurrentPosition(); }\n      catch { pos = { coords:{latitude:null,longitude:null,accuracy:null}, timestamp:Date.now() }; }\n      const { latitude, longitude, accuracy } = pos.coords;\n      setPhotos(p => [\n        ...p,\n        {\n          blob,\n          url: URL.createObjectURL(blob),\n          location: { latitude, longitude, accuracy },\n          timestamp: pos.timestamp\n        }\n      ]);\n    }, 'image/jpeg');\n  };\n\n  const toggleRec = () => {\n    if (!recorderRef.current) return setError('Please initialize the camera first.');\n    if (recording) {\n      recorderRef.current.stop();\n      setRecording(false);\n    } else {\n      recorderRef.current.start();\n      setRecording(true);\n    }\n  };\n\n  return (\n    <div className=\"mb-4\">\n      {!stream && (\n        <button\n          onClick={initCamera}\n          className=\"bg-blue-600 text-white px-4 py-2 rounded mb-2\"\n        >\n          Initialize Camera\n        </button>\n      )}\n      {error && <p className=\"text-red-600 mb-2\">Error: {error}</p>}\n\n      {stream && (\n        <>\n          <video\n            ref={videoRef}\n            autoPlay\n            playsInline\n            muted\n            className=\"w-full max-w-md mb-2 rounded shadow\"\n          />\n          <div className=\"space-x-2 mb-2\">\n            <button onClick={takePhoto} className=\"bg-green-500 text-white px-3 py-1 rounded\">\n              Take Photo\n            </button>\n            <button onClick={toggleRec} className=\"bg-yellow-500 text-white px-3 py-1 rounded\">\n              {recording ? 'Stop Recording' : 'Record Video'}\n            </button>\n          </div>\n        </>\n      )}\n\n      <div className=\"flex space-x-2 overflow-x-auto\">\n        {photos.map((p,i) => (\n          <img key={i} src={p.url} className=\"w-20 h-20 object-cover rounded\" />\n        ))}\n        {videos.map((v,i) => (\n          <video key={i} src={v.url} controls className=\"w-20 h-20 rounded\" />\n        ))}\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}