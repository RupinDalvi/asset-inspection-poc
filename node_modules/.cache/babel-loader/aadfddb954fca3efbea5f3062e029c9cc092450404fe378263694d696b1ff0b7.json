{"ast":null,"code":"/*\nFile: apps/inspection-app/src/components/MediaCapture.js\n*/import React,{useRef,useState,useEffect,useContext}from'react';import{InspectionContext}from'../contexts/InspectionContext';import{getCurrentPosition}from'../services/geolocation';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function MediaCapture(){const videoRef=useRef(null);const recorderRef=useRef(null);const[recording,setRecording]=useState(false);const{photos,setPhotos,videos,setVideos}=useContext(InspectionContext);useEffect(()=>{let stream;async function initMedia(){try{// First try environment-facing camera\ntry{stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:{ideal:'environment'}},audio:true});}catch(_err){// Fallback to any camera\nstream=await navigator.mediaDevices.getUserMedia({video:true,audio:true});}videoRef.current.srcObject=stream;recorderRef.current=new MediaRecorder(stream);recorderRef.current.ondataavailable=async e=>{const blob=e.data;let pos;try{pos=await getCurrentPosition();}catch(_unused){pos={latitude:null,longitude:null,accuracy:null,timestamp:Date.now()};}const url=URL.createObjectURL(blob);setVideos(v=>[...v,{blob,url,location:pos,timestamp:pos.timestamp}]);};}catch(err){console.error('MediaCapture init error:',err);}}initMedia();return()=>{if(stream)stream.getTracks().forEach(t=>t.stop());};},[setPhotos,setVideos]);const takePhoto=()=>{const video=videoRef.current;const canvas=document.createElement('canvas');canvas.width=video.videoWidth;canvas.height=video.videoHeight;canvas.getContext('2d').drawImage(video,0,0);canvas.toBlob(async blob=>{let pos;try{pos=await getCurrentPosition();}catch(_unused2){pos={latitude:null,longitude:null,accuracy:null,timestamp:Date.now()};}const url=URL.createObjectURL(blob);setPhotos(p=>[...p,{blob,url,location:pos,timestamp:pos.timestamp}]);},'image/jpeg');};const toggleRec=()=>{if(recording){recorderRef.current.stop();setRecording(false);}else{recorderRef.current.start();setRecording(true);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,playsInline:true,\"webkit-playsinline\":\"true\",muted:true,className:\"w-full max-w-md mb-2 rounded shadow\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:takePhoto,className:\"bg-green-500 text-white px-3 py-1 rounded\",children:\"Take Photo\"}),/*#__PURE__*/_jsx(\"button\",{onClick:toggleRec,className:\"bg-yellow-500 text-white px-3 py-1 rounded\",children:recording?'Stop Recording':'Record Video'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 flex space-x-2 overflow-x-auto\",children:[photos.map((p,i)=>/*#__PURE__*/_jsx(\"img\",{src:p.url,alt:\"Photo \".concat(i+1),className:\"w-20 h-20 object-cover rounded\"},i)),videos.map((v,i)=>/*#__PURE__*/_jsx(\"video\",{src:v.url,controls:true,className:\"w-20 h-20 rounded\"},i))]})]});}","map":{"version":3,"names":["React","useRef","useState","useEffect","useContext","InspectionContext","getCurrentPosition","jsx","_jsx","jsxs","_jsxs","MediaCapture","videoRef","recorderRef","recording","setRecording","photos","setPhotos","videos","setVideos","stream","initMedia","navigator","mediaDevices","getUserMedia","video","facingMode","ideal","audio","_err","current","srcObject","MediaRecorder","ondataavailable","e","blob","data","pos","_unused","latitude","longitude","accuracy","timestamp","Date","now","url","URL","createObjectURL","v","location","err","console","error","getTracks","forEach","t","stop","takePhoto","canvas","document","createElement","width","videoWidth","height","videoHeight","getContext","drawImage","toBlob","_unused2","p","toggleRec","start","className","children","ref","autoPlay","playsInline","muted","onClick","map","i","src","alt","concat","controls"],"sources":["C:/Development/VibeVibes/IP/apps/inspection-app/src/components/MediaCapture.js"],"sourcesContent":["/*\nFile: apps/inspection-app/src/components/MediaCapture.js\n*/\nimport React, { useRef, useState, useEffect, useContext } from 'react';\nimport { InspectionContext } from '../contexts/InspectionContext';\nimport { getCurrentPosition } from '../services/geolocation';\n\nexport default function MediaCapture() {\n  const videoRef = useRef(null);\n  const recorderRef = useRef(null);\n  const [recording, setRecording] = useState(false);\n  const { photos, setPhotos, videos, setVideos } = useContext(InspectionContext);\n\n  useEffect(() => {\n    let stream;\n\n    async function initMedia() {\n      try {\n        // First try environment-facing camera\n        try {\n          stream = await navigator.mediaDevices.getUserMedia({\n            video: { facingMode: { ideal: 'environment' } },\n            audio: true\n          });\n        } catch (_err) {\n          // Fallback to any camera\n          stream = await navigator.mediaDevices.getUserMedia({\n            video: true,\n            audio: true\n          });\n        }\n\n        videoRef.current.srcObject = stream;\n        recorderRef.current = new MediaRecorder(stream);\n        recorderRef.current.ondataavailable = async (e) => {\n          const blob = e.data;\n          let pos;\n          try { pos = await getCurrentPosition(); }\n          catch { pos = { latitude: null, longitude: null, accuracy: null, timestamp: Date.now() }; }\n          const url = URL.createObjectURL(blob);\n          setVideos(v => [\n            ...v,\n            { blob, url, location: pos, timestamp: pos.timestamp }\n          ]);\n        };\n      } catch (err) {\n        console.error('MediaCapture init error:', err);\n      }\n    }\n\n    initMedia();\n    return () => {\n      if (stream) stream.getTracks().forEach(t => t.stop());\n    };\n  }, [setPhotos, setVideos]);\n\n  const takePhoto = () => {\n    const video = videoRef.current;\n    const canvas = document.createElement('canvas');\n    canvas.width = video.videoWidth;\n    canvas.height = video.videoHeight;\n    canvas.getContext('2d').drawImage(video, 0, 0);\n    canvas.toBlob(async (blob) => {\n      let pos;\n      try { pos = await getCurrentPosition(); }\n      catch { pos = { latitude: null, longitude: null, accuracy: null, timestamp: Date.now() }; }\n      const url = URL.createObjectURL(blob);\n      setPhotos(p => [\n        ...p,\n        { blob, url, location: pos, timestamp: pos.timestamp }\n      ]);\n    }, 'image/jpeg');\n  };\n\n  const toggleRec = () => {\n    if (recording) {\n      recorderRef.current.stop();\n      setRecording(false);\n    } else {\n      recorderRef.current.start();\n      setRecording(true);\n    }\n  };\n\n  return (\n    <div className=\"mb-4\">\n      <video\n        ref={videoRef}\n        autoPlay\n        playsInline\n        webkit-playsinline=\"true\"\n        muted\n        className=\"w-full max-w-md mb-2 rounded shadow\"\n      />\n      <div className=\"space-x-2\">\n        <button onClick={takePhoto} className=\"bg-green-500 text-white px-3 py-1 rounded\">\n          Take Photo\n        </button>\n        <button onClick={toggleRec} className=\"bg-yellow-500 text-white px-3 py-1 rounded\">\n          {recording ? 'Stop Recording' : 'Record Video'}\n        </button>\n      </div>\n      <div className=\"mt-2 flex space-x-2 overflow-x-auto\">\n        {photos.map((p, i) => (\n          <img\n            key={i}\n            src={p.url}\n            alt={`Photo ${i + 1}`}\n            className=\"w-20 h-20 object-cover rounded\"\n          />\n        ))}\n        {videos.map((v, i) => (\n          <video\n            key={i}\n            src={v.url}\n            controls\n            className=\"w-20 h-20 rounded\"\n          />\n        ))}\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}